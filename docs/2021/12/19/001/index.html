<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>在NVMe硬盘安装ArchLinux+Windows11 | UrsusFeline-Blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"hostname":"http://lgy07.github.io","root":"/","preload":false,"path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.2.0"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="-"><const>prev = page.prev</const><const>next = page.next</const><const>dateConf = theme.post.date</const><const>updatedConf = theme.post.updated</const><const>sourceConf = theme.post.source</const><const>excerptConf = theme.post.excerpt</const><const>reward = theme.post.reward</const><const>encrypted = page.encrypt || page.password</const><const>tocContent = encrypted === undefined ? toc(page.content, theme.toc) : toc(page.origin, theme.toc)</const><const>countWord = theme.post.word_count === true ? wordcount(page.content) : null</const><const>countTime = theme.post.reading_time === true ? min2read(page.content) : null</const></div><div id="post-bg"><div id="post-title"><h1>在NVMe硬盘安装ArchLinux+Windows11</h1></div><hr><div id="post-content">
<h5 id="本文主要解决以下问题："><a href="#本文主要解决以下问题：" class="headerlink" title="本文主要解决以下问题："></a>本文主要解决以下问题：</h5><p><code>1.ArchLinux无法识别较新的NVMe（我的是金士顿A2000）</code></p>
<p><code>2.os-prober无法识别Windows11</code></p>
<h5 id="需要准备："><a href="#需要准备：" class="headerlink" title="需要准备："></a>需要准备：</h5><p><code>一台正常装有Windows11的电脑</code></p>
<p><code>一个耐用的U盘（最好是移动硬盘，也可以是热插拔的SATA盘），以下简称“U盘1”</code></p>
<p><code>一个烧录了ArchLive的U盘，以下简称“U盘2”</code></p>
<p><code>一个烧录了wepe的U盘，以下简称“U盘3”</code><a target="_blank" rel="noopener" href="https://www.wepe.com.cn/download.html">WePE-下载</a></p>
<p><del><code>一个没有坏掉的大脑（（（</code></del></p>
<h2 id="——ArchLinux在NVMe如何安装："><a href="#——ArchLinux在NVMe如何安装：" class="headerlink" title="——ArchLinux在NVMe如何安装："></a>——ArchLinux在NVMe如何安装：</h2><p>进入U盘2的Arch Live，并插上U盘1</p>
<p>在U盘1上安装Arch，更改以下步骤：</p>
<figure class="highlight open plaintext"><span class="code-header">    <span class="code-title">      <div class="code-icon"></div>TEXT 共 1 行</span>      <span class="code-header-tail">        <button class="code-copy"></button>        <span class="code-space">展开</span></span></span>    <div class="code-box"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">pacstrap /mnt base linux-zen linux-firmware<br></code></pre></td></tr></table></div></figure>
<p>进入chroot环境后，安装arch安装脚本：</p>
<figure class="highlight open plaintext"><span class="code-header">    <span class="code-title">      <div class="code-icon"></div>TEXT 共 1 行</span>      <span class="code-header-tail">        <button class="code-copy"></button>        <span class="code-space">展开</span></span></span>    <div class="code-box"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">pacman -S arch-install-scritps<br></code></pre></td></tr></table></div></figure>
<p>不必安装图形界面，重启后fdisk -l，就能看到NVMe硬盘了</p>
<p>按照在SATA盘安装Arch的步骤，在NVMe盘安装ArchLinux，引导分区使用Windows11的ESP分区（建议先把ESP分区删了，重新创建，因为它太小了）</p>
<p>重启后，就可以进入ArchLinux了（好耶！</p>
<h2 id="——Grub2引导ArchLinux和Windows11："><a href="#——Grub2引导ArchLinux和Windows11：" class="headerlink" title="——Grub2引导ArchLinux和Windows11："></a>——Grub2引导ArchLinux和Windows11：</h2><p>（上面的ArchLinux请使用Grub2引导</p>
<p>进入U盘3的wepe</p>
<p>打开dism++（启动时的东西都不用管）</p>
<p>选择Windows11</p>
<p>点击“工具箱”，点击引导修复，选择ArchLinux的引导分区</p>
<p>修复完成后重启系统，会正常进入Windows11，但是并没有破坏掉Grub2，启动按F12（我的是F12，请自己看主板说明，或者F*全部按一遍）进入引导菜单，找到ArchLinux（具体的名称是你安装Grub2时设置的）</p>
<figure class="highlight open plaintext"><span class="code-header">    <span class="code-title">      <div class="code-icon"></div>TEXT 共 6 行</span>      <span class="code-header-tail">        <button class="code-copy"></button>        <span class="code-space">展开</span></span></span>    <div class="code-box"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#grub-install --target=x86_64 --efi-directory=/boot --bootloader-<br>id=ArchLinux<br><br>#pacman -S vim<br><br>#vim /etc/grub.d/40_custom<br></code></pre></td></tr></table></div></figure>
<p>编辑40_custom脚本：</p>
<figure class="highlight fold plaintext"><span class="code-header">    <span class="code-title">      <div class="code-icon"></div>TEXT 共 21 行</span>      <span class="code-header-tail">        <button class="code-copy"></button>        <span class="code-space">展开</span></span></span>    <div class="code-box"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">### BEGIN /etc/grub.d/40_custom_proxy ###<br><br>menuentry &quot;Windows11&quot;  &#123;<br><br>insmod part_gpt<br><br>insmod fat<br><br>insmod chain<br><br>root=uuid= 【引导分区的文件系统UUID】<br><br>search --no-floppy --fs-uuid --set=root 【引导分区的文件系统UUID】 --hint-<br>bios=hd0,gpt0 --hint-efi=hd0,gpt0 --hint-baremetal=NVMe0,gpt0<br>【Windows11的系统分区文件系统UUID】<br><br>chainloader /EFI/Microsoft/Boot/bootmgfw.efi<br><br>&#125;<br><br>### END /etc/grub.d/40_custom_proxy ###<br></code></pre></td></tr></table></div></figure>
<p>确保你的Windows11位于硬盘第一个分区（&#x2F;dev&#x2F;NVMe0n1p1）</p>
<p>如果不是，请将上面的两个hd0改为hd*，&#x2F;dev&#x2F;NVMe0n1pX</p>
<p>*应为X-1</p>
<figure class="highlight open plaintext"><span class="code-header">    <span class="code-title">      <div class="code-icon"></div>TEXT 共 1 行</span>      <span class="code-header-tail">        <button class="code-copy"></button>        <span class="code-space">展开</span></span></span>    <div class="code-box"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#grub-makecfg -o /boot/grub/grub.cfg<br></code></pre></td></tr></table></div></figure>
<p>（如果你之前装的grub配置文件为”grub.conf”，请将以上命令的”grub.cfg”改为”grub.conf”）</p>
<h5 id="引导部分可以自己看看ArchWiki："><a href="#引导部分可以自己看看ArchWiki：" class="headerlink" title="引导部分可以自己看看ArchWiki："></a>引导部分可以自己看看ArchWiki：</h5><p><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%A4%9A%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8">GRUB (简体中文) - ArchWiki (archlinux.org)</a></p>
<div id="paginator"></div></div><div id="post-footer"></div><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">UrsusFeline</a></h1><div id="description"><p>好</p><p>耶</p><p>！</p><p>（</p><p>）</p></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85ArchLinux%E5%92%8CWindows11%E5%9C%A8NVMe%E7%A1%AC%E7%9B%98%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">如何安装ArchLinux和Windows11在NVMe硬盘：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E8%A7%A3%E5%86%B3%E4%BB%A5%E4%B8%8B%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text">本文主要解决以下问题：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87%EF%BC%9A"><span class="toc-number">1.0.0.0.2.</span> <span class="toc-text">需要准备：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%94%E2%80%94ArchLinux%E5%9C%A8NVMe%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">——ArchLinux在NVMe如何安装：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%94%E2%80%94Grub2%E5%BC%95%E5%AF%BCArchLinux%E5%92%8CWindows11%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">——Grub2引导ArchLinux和Windows11：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%95%E5%AF%BC%E9%83%A8%E5%88%86%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E7%9C%8B%E7%9C%8BArchWiki%EF%BC%9A"><span class="toc-number">1.2.0.0.1.</span> <span class="toc-text">引导部分可以自己看看ArchWiki：</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"></a></nobr><text>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></text><text> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></text><wbr><text>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></text></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: '4OBFYSidg9aamqD2yc0DNhfT-MdYXbMMI# APP ID'
 , appKey: 'EEiD9pDI8lLzqwChujX1EN6y# APP KEY', serverURLs: 'https://4obfysid.api.lncldglobal.com# APP DOMAIN（LeanCloud 国际版）' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>